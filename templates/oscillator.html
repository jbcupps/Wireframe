<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damped Harmonic Oscillator - 4D Manifold Explorer</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            /* Modern color palette - same as main app */
            --dark-bg: #121212;
            --surface: #1e1e1e;
            --surface-light: #2d2d2d;
            --primary: #BB86FC;
            --primary-variant: #3700B3;
            --secondary: #03DAC6;
            --accent: #CF6679;
            --text-primary: rgba(255, 255, 255, 0.87);
            --text-secondary: rgba(255, 255, 255, 0.6);
            --border-color: rgba(255, 255, 255, 0.12);
            
            /* Function Colors */
            --real-color: #FF6E91;  /* Vivid pink */
            --imag-color: #33C4FF;  /* Bright blue */
            --envelope-color: #65FF8F;  /* Bright green */
            --special-value: #BB86FC;  /* Purple */
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Site Header Styles */
        .site-header {
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            background-color: rgba(18, 18, 18, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
            padding: 15px 0;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 300;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 1.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 1rem;
            transition: all 0.3s ease;
            padding: 5px 0;
            position: relative;
        }
        
        .nav-links a:hover, .nav-links a.active {
            color: var(--primary);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        
        .nav-links a:hover::after, .nav-links a.active::after {
            width: 100%;
        }
        
        /* Main content padding for fixed header */
        .main-content {
            margin-top: 80px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        header .subtitle {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text-secondary);
        }
        
        .formula {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .back-button {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 15px;
            background-color: var(--surface-light);
            border-radius: 6px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .back-button:hover {
            background-color: var(--surface);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .controls-panel {
            background-color: var(--surface);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .parameter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .parameter {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 200px;
        }
        
        .parameter label {
            margin-right: 10px;
            font-weight: bold;
            min-width: 120px;
        }
        
        .parameter input[type="range"] {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            background: var(--surface-light);
            outline: none;
            border-radius: 3px;
        }
        
        .parameter input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }
        
        .parameter span {
            min-width: 40px;
            text-align: right;
            margin-left: 10px;
            font-family: 'Courier New', monospace;
        }
        
        .animation-controls {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-top: 1px solid var(--border-color);
            margin-top: 10px;
        }
        
        .animation-controls button {
            padding: 8px 16px;
            background-color: var(--primary);
            color: #000;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 15px;
            min-width: 80px;
        }
        
        .animation-controls button:hover {
            background-color: var(--primary-variant);
            color: white;
        }
        
        .animation-controls input[type="range"] {
            flex: 1;
            margin: 0 15px;
        }
        
        .visualization-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .plot {
            background-color: var(--surface);
            border-radius: 12px;
            height: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .annotations {
            background-color: var(--surface);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .period-annotation {
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .formulas {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {
            .visualization-container {
                grid-template-columns: 1fr;
            }
            
            .plot {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Site Navigation Header -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">
                    <i class="fas fa-cube"></i>
                    <span>4D Manifold Explorer</span>
                </a>
                <nav class="nav-links">
                    <a href="/">Home</a>
                    <a href="/visualization">4D Manifold</a>
                    <a href="/evolution">Evolution</a>
                    <a href="/oscillator" class="active">Oscillator</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="main-content">
        <div class="container">
            <header>
                <h1>Damped Harmonic Oscillator with Gaussian Envelope</h1>
                <div class="subtitle">
                    Visualizing the complex function \( f(t) = e^{-\gamma(t-t_0)^2}(\cos(\omega t) + i\sin(\omega t)) \)
                </div>
            </header>
            
            <div class="controls-panel">
                <div class="parameter-controls">
                    <div class="parameter">
                        <label for="gamma">γ (Damping factor):</label>
                        <input type="range" id="gamma" min="0.01" max="0.5" step="0.01" value="0.1">
                        <span id="gamma-value">0.1</span>
                    </div>
                    <div class="parameter">
                        <label for="t0">t₀ (Time offset):</label>
                        <input type="range" id="t0" min="1" max="10" step="0.1" value="5">
                        <span id="t0-value">5</span>
                    </div>
                    <div class="parameter">
                        <label for="omega">ω (Angular frequency):</label>
                        <input type="range" id="omega" min="0.5" max="5" step="0.1" value="2">
                        <span id="omega-value">2</span>
                    </div>
                </div>
                <div class="animation-controls">
                    <button id="play-pause">
                        <i class="fas fa-play"></i> Play
                    </button>
                    <input type="range" id="time-slider" min="0" max="10" step="0.1" value="0">
                    <span id="current-time">t = 0.00</span>
                </div>
            </div>

            <div class="visualization-container">
                <div id="plot3d" class="plot"></div>
                <div id="spiral-plot" class="plot"></div>
                <div id="real-plot" class="plot"></div>
                <div id="imag-plot" class="plot"></div>
            </div>

            <div class="annotations">
                <div class="period-annotation">
                    \(\omega \cdot \text{const} = 3.45T\), where \(T = \frac{2\pi}{\omega}\)
                </div>
                <div class="formulas">
                    <div>Re\(f\) = \(e^{-\gamma(t-t_0)^2}\cos(\omega t)\)</div>
                    <div>Im\(f\) = \(e^{-\gamma(t-t_0)^2}\sin(\omega t)\)</div>
                </div>
            </div>

            <!-- Theory and Mathematics Section -->
            <div class="control-card" style="margin-top: 30px;">
                <div class="card-header">
                    <h3 class="card-title">Theory & Mathematics</h3>
                </div>
                <div style="padding: 15px;">
                    <h4>The Mathematics of Complex Harmonic Oscillators</h4>
                    <p>
                        The complex damped harmonic oscillator with a Gaussian envelope is described by the function:
                        \[ f(t) = e^{-\gamma(t-t_0)^2}(\cos(\omega t) + i\sin(\omega t)) \]
                        
                        This mathematical object combines several fundamental concepts:
                    </p>
                    
                    <ul style="padding-left: 20px; margin: 15px 0;">
                        <li><strong>Complex Exponential:</strong> The term \(e^{i\omega t} = \cos(\omega t) + i\sin(\omega t)\) represents uniform circular motion in the complex plane.</li>
                        <li><strong>Gaussian Envelope:</strong> The factor \(e^{-\gamma(t-t_0)^2}\) creates a bell-shaped amplitude modulation centered at \(t_0\).</li>
                        <li><strong>Wave Packet:</strong> Together, these form a wave packet with frequency \(\omega\) and localization parameter \(\gamma\).</li>
                    </ul>

                    <h4>Applications in Physics</h4>
                    <p>
                        This mathematical structure appears in numerous areas of physics:
                    </p>
                    
                    <ul style="padding-left: 20px; margin: 15px 0;">
                        <li><strong>Quantum Mechanics:</strong> Gaussian wave packets represent localized quantum particles.</li>
                        <li><strong>Signal Processing:</strong> Modulated signals with controlled frequency and amplitude decay.</li>
                        <li><strong>4D Manifold Theory:</strong> Representations of time-varying fields on topological structures.</li>
                        <li><strong>Particle Physics:</strong> Models of particle decay and resonance phenomena.</li>
                    </ul>
                    
                    <h4>Historical Context</h4>
                    <p>
                        The study of harmonic oscillators dates back to the 17th century with Hooke's work on springs, but their complex representation emerged in the 19th century through the work of mathematicians like Euler, who introduced the complex exponential form \(e^{i\theta} = \cos(\theta) + i\sin(\theta)\).
                    </p>
                    <p>
                        Gaussian wave packets became crucial in the early 20th century with the development of quantum mechanics. Schrödinger's wave equation (1926) and Heisenberg's uncertainty principle demonstrated how localized wave packets represent quantum particles with complementary uncertainties in position and momentum.
                    </p>
                    <p>
                        Today, these mathematical structures serve as fundamental building blocks in fields ranging from quantum field theory to signal analysis and modern 4D manifold topology.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">4D Manifold Explorer</div>
                <div class="footer-links">
                    <a href="/">Home</a>
                    <a href="/visualization">4D Manifold</a>
                    <a href="/evolution">Evolution</a>
                    <a href="/oscillator">Oscillator</a>
                </div>
            </div>
            <div class="copyright">
                &copy; 2024 4D Manifold Explorer. All rights reserved.
            </div>
        </div>
    </footer>
    </div> <!-- Close main-content div -->
    
    <script>
        // Global variables
        let animationId;
        let isPlaying = false;
        let currentTime = 0;
        let scene, camera, renderer, controls, oscillatorPath;
        let pointCloud = [];
        let maxPoints = 1000;
        let timeStep = 0.01;
        
        // Initial parameter values
        let gamma = 0.1;
        let t0 = 5;
        let omega = 2;
        
        // DOM references
        const gammaSlider = document.getElementById('gamma');
        const t0Slider = document.getElementById('t0');
        const omegaSlider = document.getElementById('omega');
        const timeSlider = document.getElementById('time-slider');
        const playPauseButton = document.getElementById('play-pause');
        const currentTimeDisplay = document.getElementById('current-time');
        
        // Value displays
        const gammaValue = document.getElementById('gamma-value');
        const t0Value = document.getElementById('t0-value');
        const omegaValue = document.getElementById('omega-value');
        
        // Calculate the function f(t) = e^(-γ(t-t0)^2) * (cos(ωt) + i*sin(ωt))
        function calculateF(t) {
            const envelope = Math.exp(-gamma * Math.pow(t - t0, 2));
            const real = envelope * Math.cos(omega * t);
            const imag = envelope * Math.sin(omega * t);
            return { real, imag, envelope, t };
        }
        
        // Calculate the wave function for a range of time values
        function calculateWaveFunction(tMin, tMax, steps) {
            const data = [];
            const stepSize = (tMax - tMin) / steps;
            
            for (let i = 0; i <= steps; i++) {
                const t = tMin + i * stepSize;
                data.push(calculateF(t));
            }
            
            return data;
        }
        
        // Initialize Three.js 3D plot
        function init3DPlot() {
            // Create scene, camera, and renderer
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1e1e1e);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, document.getElementById('plot3d').clientWidth / document.getElementById('plot3d').clientHeight, 0.1, 1000);
            camera.position.set(5, 5, 5);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(document.getElementById('plot3d').clientWidth, document.getElementById('plot3d').clientHeight);
            document.getElementById('plot3d').appendChild(renderer.domElement);
            
            // Controls setup
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.25;
            
            // Axis helpers
            const axesHelper = new THREE.AxesHelper(10);
            scene.add(axesHelper);
            
            // Add coordinate system labels
            addCoordinateLabels();
            
            // Create path for oscillator
            createOscillatorPath();
            
            // Animation loop
            animate();
            
            // Handle window resize
            window.addEventListener('resize', on3DWindowResize);
        }
        
        // Add coordinate system labels to 3D plot
        function addCoordinateLabels() {
            const axisLabels = [
                { text: "Re", position: new THREE.Vector3(10, 0, 0), color: 0xFF6E91 },
                { text: "Im", position: new THREE.Vector3(0, 0, 10), color: 0x33C4FF },
                { text: "t", position: new THREE.Vector3(0, 10, 0), color: 0xFFFFFF }
            ];
            
            // Create canvas and context to render text
            const canvas = document.createElement('canvas');
            canvas.width = 128;
            canvas.height = 128;
            const context = canvas.getContext('2d');
            
            axisLabels.forEach(label => {
                context.clearRect(0, 0, canvas.width, canvas.height);
                context.fillStyle = '#' + label.color.toString(16).padStart(6, '0');
                context.font = 'Bold 80px Arial';
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.fillText(label.text, 64, 64);
                
                const texture = new THREE.CanvasTexture(canvas);
                const material = new THREE.SpriteMaterial({ map: texture });
                const sprite = new THREE.Sprite(material);
                sprite.position.copy(label.position);
                sprite.scale.set(1, 1, 1);
                scene.add(sprite);
            });
        }
        
        // Create the oscillator path in 3D space
        function createOscillatorPath() {
            // Remove previous path if it exists
            if (oscillatorPath) scene.remove(oscillatorPath);
            
            // Calculate wave function data
            const data = calculateWaveFunction(0, 10, 1000);
            
            // Create geometry for the path
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(data.length * 3);
            
            // Set positions from data
            for (let i = 0; i < data.length; i++) {
                const point = data[i];
                positions[i * 3] = point.real * 5;     // Re axis (x)
                positions[i * 3 + 1] = point.t;        // t axis (y)
                positions[i * 3 + 2] = point.imag * 5; // Im axis (z)
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            // Create line material with gradient
            const material = new THREE.LineBasicMaterial({
                color: 0xBB86FC,
                linewidth: 2
            });
            
            // Create and add line to scene
            oscillatorPath = new THREE.Line(geometry, material);
            scene.add(oscillatorPath);
            
            // Current position indicator
            updateCurrentPositionIndicator();
        }
        
        // Create and update current position indicator
        function updateCurrentPositionIndicator() {
            // Remove existing indicator if present
            scene.children.forEach(child => {
                if (child.userData && child.userData.isPositionIndicator) {
                    scene.remove(child);
                }
            });
            
            // Calculate current position
            const f = calculateF(currentTime);
            
            // Create sphere geometry
            const geometry = new THREE.SphereGeometry(0.15, 32, 32);
            const material = new THREE.MeshBasicMaterial({ color: 0xCF6679 });
            const sphere = new THREE.Mesh(geometry, material);
            
            // Set position
            sphere.position.set(f.real * 5, currentTime, f.imag * 5);
            sphere.userData = { isPositionIndicator: true };
            
            // Add to scene
            scene.add(sphere);
        }
        
        // Animation loop for 3D plot
        function animate() {
            animationId = requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // Handle window resize for 3D plot
        function on3DWindowResize() {
            const container = document.getElementById('plot3d');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        // Initialize Plotly spiral plot
        function initSpiralPlot() {
            const data = calculateWaveFunction(0, 10, 1000);
            
            // Extract real and imaginary data
            const realData = data.map(point => point.real);
            const imagData = data.map(point => point.imag);
            
            // Create spiral plot
            const trace = {
                x: realData,
                y: imagData,
                mode: 'lines',
                name: 'Complex Trajectory',
                line: {
                    color: 'rgb(187, 134, 252)',
                    width: 2
                }
            };
            
            // Current position marker
            const currentPoint = calculateF(currentTime);
            const markerTrace = {
                x: [currentPoint.real],
                y: [currentPoint.imag],
                mode: 'markers',
                marker: {
                    color: 'rgb(207, 102, 121)',
                    size: 10
                },
                showlegend: false
            };
            
            const layout = {
                title: 'Complex Plane (Re-Im)',
                xaxis: {
                    title: 'Re',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    zerolinecolor: 'rgba(255, 255, 255, 0.3)'
                },
                yaxis: {
                    title: 'Im',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    zerolinecolor: 'rgba(255, 255, 255, 0.3)'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {
                    color: 'rgba(255, 255, 255, 0.87)'
                },
                margin: { l: 50, r: 30, t: 50, b: 50 }
            };
            
            Plotly.newPlot('spiral-plot', [trace, markerTrace], layout);
        }
        
        // Initialize real component plot
        function initRealPlot() {
            const data = calculateWaveFunction(0, 10, 1000);
            
            // Extract time and real data
            const timeData = data.map(point => point.t);
            const realData = data.map(point => point.real);
            const envelopeData = data.map(point => point.envelope);
            const negEnvelopeData = data.map(point => -point.envelope);
            
            // Create real component plot
            const traceFn = {
                x: timeData,
                y: realData,
                mode: 'lines',
                name: 'Re(f)',
                line: {
                    color: 'rgb(255, 110, 145)',
                    width: 2
                }
            };
            
            // Add positive envelope
            const traceEnvPos = {
                x: timeData,
                y: envelopeData,
                mode: 'lines',
                name: 'Envelope',
                line: {
                    color: 'rgb(101, 255, 143)',
                    width: 1,
                    dash: 'dash'
                }
            };
            
            // Add negative envelope
            const traceEnvNeg = {
                x: timeData,
                y: negEnvelopeData,
                mode: 'lines',
                name: 'Envelope',
                line: {
                    color: 'rgb(101, 255, 143)',
                    width: 1,
                    dash: 'dash'
                },
                showlegend: false
            };
            
            // Current time marker
            const currentPoint = calculateF(currentTime);
            const markerTrace = {
                x: [currentTime],
                y: [currentPoint.real],
                mode: 'markers',
                marker: {
                    color: 'rgb(207, 102, 121)',
                    size: 10
                },
                showlegend: false
            };
            
            const layout = {
                title: 'Real Component vs Time',
                xaxis: {
                    title: 't',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    zerolinecolor: 'rgba(255, 255, 255, 0.3)'
                },
                yaxis: {
                    title: 'Re(f)',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    zerolinecolor: 'rgba(255, 255, 255, 0.3)'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {
                    color: 'rgba(255, 255, 255, 0.87)'
                },
                margin: { l: 50, r: 30, t: 50, b: 50 }
            };
            
            Plotly.newPlot('real-plot', [traceFn, traceEnvPos, traceEnvNeg, markerTrace], layout);
        }
        
        // Initialize imaginary component plot
        function initImagPlot() {
            const data = calculateWaveFunction(0, 10, 1000);
            
            // Extract time and imaginary data
            const timeData = data.map(point => point.t);
            const imagData = data.map(point => point.imag);
            const envelopeData = data.map(point => point.envelope);
            const negEnvelopeData = data.map(point => -point.envelope);
            
            // Create imaginary component plot
            const traceFn = {
                x: timeData,
                y: imagData,
                mode: 'lines',
                name: 'Im(f)',
                line: {
                    color: 'rgb(51, 196, 255)',
                    width: 2
                }
            };
            
            // Add positive envelope
            const traceEnvPos = {
                x: timeData,
                y: envelopeData,
                mode: 'lines',
                name: 'Envelope',
                line: {
                    color: 'rgb(101, 255, 143)',
                    width: 1,
                    dash: 'dash'
                }
            };
            
            // Add negative envelope
            const traceEnvNeg = {
                x: timeData,
                y: negEnvelopeData,
                mode: 'lines',
                name: 'Envelope',
                line: {
                    color: 'rgb(101, 255, 143)',
                    width: 1,
                    dash: 'dash'
                },
                showlegend: false
            };
            
            // Current time marker
            const currentPoint = calculateF(currentTime);
            const markerTrace = {
                x: [currentTime],
                y: [currentPoint.imag],
                mode: 'markers',
                marker: {
                    color: 'rgb(207, 102, 121)',
                    size: 10
                },
                showlegend: false
            };
            
            const layout = {
                title: 'Imaginary Component vs Time',
                xaxis: {
                    title: 't',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    zerolinecolor: 'rgba(255, 255, 255, 0.3)'
                },
                yaxis: {
                    title: 'Im(f)',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    zerolinecolor: 'rgba(255, 255, 255, 0.3)'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {
                    color: 'rgba(255, 255, 255, 0.87)'
                },
                margin: { l: 50, r: 30, t: 50, b: 50 }
            };
            
            Plotly.newPlot('imag-plot', [traceFn, traceEnvPos, traceEnvNeg, markerTrace], layout);
        }
        
        // Update all plots with current parameters
        function updatePlots() {
            // Update 3D path
            createOscillatorPath();
            
            // Update spiral plot
            const data = calculateWaveFunction(0, 10, 1000);
            const realData = data.map(point => point.real);
            const imagData = data.map(point => point.imag);
            const currentPoint = calculateF(currentTime);
            
            Plotly.update('spiral-plot', {
                x: [realData, [currentPoint.real]],
                y: [imagData, [currentPoint.imag]]
            });
            
            // Update real plot
            const timeData = data.map(point => point.t);
            const realCompData = data.map(point => point.real);
            const envelopeData = data.map(point => point.envelope);
            const negEnvelopeData = data.map(point => -point.envelope);
            
            Plotly.update('real-plot', {
                x: [timeData, timeData, timeData, [currentTime]],
                y: [realCompData, envelopeData, negEnvelopeData, [currentPoint.real]]
            });
            
            // Update imaginary plot
            const imagCompData = data.map(point => point.imag);
            
            Plotly.update('imag-plot', {
                x: [timeData, timeData, timeData, [currentTime]],
                y: [imagCompData, envelopeData, negEnvelopeData, [currentPoint.imag]]
            });
        }
        
        // Update time in the animation
        function updateTime(time) {
            currentTime = time;
            timeSlider.value = time;
            currentTimeDisplay.textContent = `t = ${time.toFixed(2)}`;
            
            // Update position indicator in 3D plot
            updateCurrentPositionIndicator();
            
            // Update 2D plots
            const currentPoint = calculateF(currentTime);
            
            Plotly.update('spiral-plot', {
                x: [[currentPoint.real]],
                y: [[currentPoint.imag]]
            }, {}, [1]);
            
            Plotly.update('real-plot', {
                x: [[currentTime]],
                y: [[currentPoint.real]]
            }, {}, [3]);
            
            Plotly.update('imag-plot', {
                x: [[currentTime]],
                y: [[currentPoint.imag]]
            }, {}, [3]);
        }
        
        // Play/pause animation
        function togglePlayPause() {
            isPlaying = !isPlaying;
            
            if (isPlaying) {
                playPauseButton.innerHTML = '<i class="fas fa-pause"></i> Pause';
                startAnimation();
            } else {
                playPauseButton.innerHTML = '<i class="fas fa-play"></i> Play';
                stopAnimation();
            }
        }
        
        // Start animation loop
        function startAnimation() {
            let lastTime = performance.now();
            let animSpeed = 0.5; // Animation speed multiplier
            
            function animationLoop(currentTimestamp) {
                const deltaTime = (currentTimestamp - lastTime) / 1000;
                lastTime = currentTimestamp;
                
                currentTime += deltaTime * animSpeed;
                
                // Loop back to start if we reach the end
                if (currentTime > 10) {
                    currentTime = 0;
                }
                
                updateTime(currentTime);
                
                if (isPlaying) {
                    animationId = requestAnimationFrame(animationLoop);
                }
            }
            
            animationId = requestAnimationFrame(animationLoop);
        }
        
        // Stop animation loop
        function stopAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }
        
        // Initialize all visualizations
        function initVisualizations() {
            init3DPlot();
            initSpiralPlot();
            initRealPlot();
            initImagPlot();
        }
        
        // Event listeners for controls
        gammaSlider.addEventListener('input', function() {
            gamma = parseFloat(this.value);
            gammaValue.textContent = gamma.toFixed(2);
            updatePlots();
        });
        
        t0Slider.addEventListener('input', function() {
            t0 = parseFloat(this.value);
            t0Value.textContent = t0.toFixed(1);
            updatePlots();
        });
        
        omegaSlider.addEventListener('input', function() {
            omega = parseFloat(this.value);
            omegaValue.textContent = omega.toFixed(1);
            updatePlots();
        });
        
        timeSlider.addEventListener('input', function() {
            currentTime = parseFloat(this.value);
            updateTime(currentTime);
        });
        
        playPauseButton.addEventListener('click', togglePlayPause);
        
        // Initialize everything on page load
        document.addEventListener('DOMContentLoaded', function() {
            initVisualizations();
        });
    </script>
</body>
</html> 